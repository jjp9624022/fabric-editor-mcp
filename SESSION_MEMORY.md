# ðŸ§  å¼€å‘è€…ä¼šè¯è®°å¿†ä¸ŽæŠ€æœ¯ç»éªŒæ€»ç»“ (2026-02-07)

## 1. æ ¸å¿ƒç›®æ ‡

æž„å»ºä¸€ä¸ªå…¨è§£è€¦ã€æ”¯æŒæ— å¤´æ¸²æŸ“ï¼ˆHeadless Renderingï¼‰çš„ MCP äº‘ç«¯ç»˜å›¾æž¶æž„ï¼Œå¹¶å®žçŽ°ä¸€é”®è‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

## 2. æœ€ç»ˆæž¶æž„å…³ç³» (å®¿ä¸»æœºæ¨¡å¼)

- **ä¸­æž¢ (mcp-server)**: è¿è¡Œåœ¨å®¿ä¸»æœºçš„ Node.js è¿›ç¨‹ï¼Œç›‘å¬ 8082 ç«¯å£ã€‚
- **æ¸²æŸ“ç«¯ (mcp-renderer)**: è¿è¡Œåœ¨å®¿ä¸»æœºçš„ Playwright è¿›ç¨‹ï¼Œä½œä¸ºåŽå°æœåŠ¡ã€‚
- **UI ç«¯ (vue-fabric-editor)**: è¿è¡Œåœ¨å®¿ä¸»æœºçš„ `pnpm preview` æœåŠ¡ï¼Œç›‘å¬ 8888 ç«¯å£ã€‚

## 3. å…³é”®è¯•é”™ä¸Žè§£å†³æ–¹æ¡ˆ (Trial & Error)

### A. å®¿ä¸»æœºè¿›ç¨‹è‡ªåŠ¨åŒ–ç®¡ç†

- **é—®é¢˜**: æ‰‹åŠ¨å¯åŠ¨å¤šä¸ª Node è¿›ç¨‹å¤ªç¹çä¸”éš¾ä»¥ç›‘æŽ§ã€‚
- **è§£å†³æ–¹æ¡ˆ**: åœ¨ `remote-sync.js` ä¸­é›†æˆ `pkill` ä¸Ž `nohup` ç»„åˆï¼Œå®žçŽ°ä¸€é”®é‡å¯ã€‚æ›´é«˜çº§çš„æ–¹æ¡ˆæŽ¨èä½¿ç”¨ `pm2`ã€‚

### B. Tar æ‰“åŒ…å†²çª

- **é—®é¢˜**: åœ¨æœ¬åœ°è¿è¡Œ `tar` åŽ‹ç¼©è‡ªèº«ç›®å½•æ—¶ï¼Œå›  `deploy.tar.gz` æ­£åœ¨è¢«å†™å…¥è€ŒæŠ¥é”™ `file changed as we read it`ã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  1. ä½¿ç”¨ `--exclude=deploy.tar.gz` æ˜Žç¡®æŽ’é™¤è¾“å‡ºæ–‡ä»¶ã€‚
  2. å¢žåŠ  `--ignore-failed-read` å‚æ•°æé«˜è„šæœ¬åœ¨æ–‡ä»¶å˜åŠ¨æ—¶çš„å®¹é”™çŽ‡ã€‚

### C. çŽ¯å¢ƒåœ°å€è§£è€¦

- **é—®é¢˜**: å®¿ä¸»æœºçŽ¯å¢ƒä¸‹ç«¯å£å†²çªæˆ–åœ°å€è¯†åˆ«ã€‚
- **è§£å†³æ–¹æ¡ˆ**: åœ¨å¯åŠ¨å‘½ä»¤ä¸­é€šè¿‡ `export` æ˜¾å¼æ³¨å…¥ `PORT`ã€`TARGET_URL` å’Œ `WS_URL` çŽ¯å¢ƒå˜é‡ï¼Œç¡®ä¿ä¸‰æ–¹æœåŠ¡æ¡æ‰‹æˆåŠŸã€‚

### D. æŒ‡ä»¤è¯†åˆ«ä¸Žé—­çŽ¯åé¦ˆ

- **é—®é¢˜**: `get_screenshot` æŒ‡ä»¤å‘å‡ºåŽï¼Œæ¸²æŸ“å™¨æŠ¥é”™â€œæœªçŸ¥æŒ‡ä»¤â€ï¼Œä¸”æµ‹è¯•è„šæœ¬æ”¶ä¸åˆ°å›¾ç‰‡ payloadã€‚
- **è§£å†³æ–¹æ¡ˆ**:
  1. **æ‹¼å†™å¯¹é½**: ç»Ÿä¸€å‰ç«¯æ’ä»¶ `DesignAutomationPlugin.ts` ä¸ŽåŽç«¯ `index.js` çš„æŒ‡ä»¤åä¸º `get_screenshot`ã€‚
  2. **å¼‚æ­¥è¿½è¸ª**: åœ¨ `mcp-server` ç»´æŠ¤ `pendingRequests` Mapï¼Œåˆ©ç”¨ `requestId` å®žçŽ°â€œè¯·æ±‚-å¹¿æ’­-å“åº”å›žä¼ â€çš„å¼‚æ­¥é—­çŽ¯ã€‚

### E. è·¯å¾„æƒé™ä¸Žè¿ç§»

- **é—®é¢˜**: è¿œç«¯ç›®å½•ä»Ž `/root` è¿å¾€ `/opt`ã€‚
- **è§£å†³æ–¹æ¡ˆ**: é›†ä¸­åŒ–é…ç½® `remote-sync.js` ä¸­çš„ `CONFIG.remoteDir`ã€‚

## 4. ç®€åŒ–åŽçš„éƒ¨ç½²æµç¨‹ (Git æ¨¡å¼)

- **ä¸Šä¼ **: é€šè¿‡ Git ç›´æŽ¥æŽ¨é€/æ‹‰å–ä»£ç ã€‚
- **è¿è¡Œ**: åœ¨æœåŠ¡å™¨å®¿ä¸»æœºé€šè¿‡ç®€å•çš„ Node å‘½ä»¤å¯åŠ¨æœåŠ¡ã€‚
- **ç®¡ç†**: å»ºè®®ä½¿ç”¨ `pm2` ç®¡ç†è¿›ç¨‹ä»¥ä¿è¯ç¨³å®šæ€§ã€‚

## 5. å¿«é€Ÿå¯åŠ¨æŒ‡å— (å®¿ä¸»æœº)

åœ¨æœåŠ¡å™¨æ‹‰å–ä»£ç åŽï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. `pnpm install` (å®‰è£…ä¾èµ–)
2. `pnpm build` (æž„å»ºå‰ç«¯)
3. å¯åŠ¨ä¸­æž¢: `export PORT=8082 && nohup node mcp-server/index.js > mcp-server.log 2>&1 &`
4. å¯åŠ¨æ¸²æŸ“å™¨: `export TARGET_URL=http://localhost:8888 && export WS_URL=ws://localhost:8082 && nohup node mcp-server/renderer.js > mcp-renderer.log 2>&1 &`
5. å¯åŠ¨å‰ç«¯: `nohup pnpm preview --port 8888 > frontend.log 2>&1 &`
